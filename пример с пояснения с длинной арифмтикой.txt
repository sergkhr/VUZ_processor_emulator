VAR n 5 0
ARR_ALLOC array 5 0

; === ЗАПОЛНЕНИЕ МАССИВА [-3, 2, -3, 12, -5] ===
MOV_LIT reg5 -3 0
SET_MEM_OFFSET array reg5 0
MOV_LIT reg5 2 0
SET_MEM_OFFSET array reg5 1
MOV_LIT reg5 -3 0
SET_MEM_OFFSET array reg5 2
MOV_LIT reg5 12 0
SET_MEM_OFFSET array reg5 3
MOV_LIT reg5 -5 0
SET_MEM_OFFSET array reg5 4

; === ИНИЦИАЛИЗАЦИЯ ===
MOV_LIT iterator 0 0
MOV_LIT reg5 1 0
MOV_MEM_OFFSET reg4 n 0

; Начальное значение результата = 1
MOV_LIT reg6 1 0  ; Low Byte
MOV_LIT reg7 0 0  ; High Byte

MOV_LIT reg9 0 0  ; Константа 0 для сравнения

MARK M0 0 0
    ; Загружаем множитель в reg3
    MOV_MEM_OFFSET_REG reg3 array iterator

    ; 1. Умножаем старшую часть числа
    MOV reg8 reg7 0
    MUL reg8 reg8 reg3    ; reg8 = High * M

    ; 2. Коррекция знака (если младший байт "отрицательный", то для 16-бит это +256)
    CMP 0 reg6 reg9       ; Проверяем, меньше ли нуля reg6
    JS CORRECTION 0 0     ; Если да, прыгаем на коррекцию
    JMP MULTIPLY_LOW 0 0

    MARK CORRECTION 0 0
    ADD reg8 reg8 reg3    ; Коррекция: добавляем множитель к старшему байту

    MARK MULTIPLY_LOW 0 0
    ; 3. Умножаем младшую часть (Результат: reg6, а старший байт попадет в EXT)
    MUL reg6 reg6 reg3

    ; 4. Складываем вычисленный старший байт (reg8) и перенос от умножения младшего (EXT)
    ADD reg7 reg8 EXT     ; <--- ИСПРАВЛЕНО ЗДЕСЬ (было high_byte)

    ; Управление циклом
    ADD iterator iterator reg5
    CMP 0 iterator reg4
    JNZ M0 0 0

; Сохраняем младший байт в result (хотя полное число лежит в reg7:reg6)
MOV result reg6 0


















VAR n 5 0
ARR_ALLOC array 5 0

MOV_LIT reg5 -3 0
SET_MEM_OFFSET array reg5 0
MOV_LIT reg5 2 0
SET_MEM_OFFSET array reg5 1
MOV_LIT reg5 -3 0
SET_MEM_OFFSET array reg5 2
MOV_LIT reg5 12 0
SET_MEM_OFFSET array reg5 3
MOV_LIT reg5 -5 0
SET_MEM_OFFSET array reg5 4

MOV_LIT iterator 0 0
MOV_LIT reg5 1 0
MOV_MEM_OFFSET reg4 n 0

MOV_LIT reg6 1 0
MOV_LIT reg7 0 0

MOV_LIT reg9 0 0

MARK M0 0 0
MOV_MEM_OFFSET_REG reg3 array iterator

MOV reg8 reg7 0
MUL reg8 reg8 reg3

CMP 0 reg6 reg9
JS CORRECTION 0 0
JMP MULTIPLY_LOW 0 0

MARK CORRECTION 0 0
ADD reg8 reg8 reg3

MARK MULTIPLY_LOW 0 0
MUL reg6 reg6 reg3

ADD reg7 reg8 EXT

ADD iterator iterator reg5
CMP 0 iterator reg4
JNZ M0 0 0

MOV result reg6 0